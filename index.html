<!DOCTYPE html>
<html>
    <head>
        <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    </head>
    <body>
        <script>
            // http://jsfiddle.net/mdml/da37B/
            /**
             * Here we setup D3 stuffs
             */
            document.addEventListener( "DOMContentLoaded", function(){
                var banner = document.getElementById('banner');
                banner.textContent = 'd3 version ' + d3.version;

                // select the SVG
                var svg = d3.select('svg');
                // the internal slider
                var slider = svg.select('.g-parameter-value');

                // create the drag behaviour
                var drag = d3.behavior.drag().on("dragstart", function() {
                    d3.event.sourceEvent.stopPropagation(); // silence other listeners
                    console.log('######### dragstart');
                }).on('drag', dragmove);

                    function dragmove(d, i) {
                        d3.select(this).attr("transform", "translate(" + d3.event.x + ",0)");
                    }

                // and attach it to the slider
                slider.call(drag);

                d3.select('#do').on('click', function() {
                    var value = d3.select('#value')[0][0].value;
                    var count = d3.select('#count')[0][0].value;

                    Diagram.add(value, count);
                });

                // this is the view
                var Diagram = {
                    svg: d3.select('svg'),
                    offset: 0,

                    add: function(value, count) {
                        function highlight() {
                            d3.select(this).attr('fill', 'rgba(0, 0, 255, 1)')
                        }

                        function dehighlight() {
                            d3.select(this).attr('fill', 'rgba(0, 0, 255, 0.75)')
                        }

                        var real_width = value * count;

                        this.svg.append('rect')
                            .attr('class', 'taglio')
                            .attr('width', real_width)
                            .attr('height', 240)
                            .attr('fill', 'rgba(0, 0, 255, 0.75)')
                            .attr('stroke', 'rgba(0,0,0,.5)')
                            .attr('x', this.offset)
                            .attr('y', 0)
                            .on('mouseover', highlight)
                            .on('mouseout', dehighlight)
                                ;
                            this.offset += real_width;
                    }
                };

                // this is the model representing the cuts
                var Lavorazione = {
                    tagli: [],

                    add: function(value, count) {
                        this.tagli.push({"value": value, "count": count});
                    }
                };
            });

        </script>
        <div id="banner"></div>
        <svg height="250" width="550">
            <g class="g-parameter-value" transform="translate(174,0)">
              <path d="M-5.5,-2.5v10l6,5.5l6,-5.5v-10z"/>
            </g>
            <rect
               style="color:#000000;fill:none;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate"
               id="rect2985"
               width="545"
               height="240"
               x="0.5"
               y="0.5" />
        </svg>
        <div id="editor">
            <input id="value" type="text" placeholder="value" />
            <input id="count" type="text" placeholder="count" />
            <button id="do">taglia</button>
        </div>
    </body>
</html>
